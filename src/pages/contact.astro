---
import Layout from "@layouts/Layout.astro";

const pageTitle = "Contacto";
const description =
  "¿Tienes ideas, preguntas o quieres colaborar con The 3 A.M Club? Escríbenos y conecta con nuestra comunidad nocturna que explora conversaciones profundas cada madrugada.";
const url = "/contact";
---

<Layout pageTitle={pageTitle} description={description} url={url}>
  <div class="mb-8 text-center">
    <div
      class="mx-auto mb-4 h-0.5 w-16 bg-gradient-to-r from-transparent via-[#790063] to-transparent"
    >
    </div>
    <h2 class="mb-2 text-3xl font-bold tracking-wider text-white">CONTACTO</h2>
    <div
      class="mx-auto h-0.5 w-24 bg-gradient-to-r from-transparent via-cyan-400 to-transparent"
    >
    </div>
  </div>
  <div class="mb-8">
    <div class="rounded-[10px] border border-purple-500/30 bg-black/30 p-6">
      <p class="mb-4 text-center leading-relaxed text-purple-100">
        <span class="font-semibold text-cyan-400">Conecta con nosotros</span> y forma
        parte de la conversación nocturna.
      </p>
      <p class="text-center text-sm leading-relaxed text-purple-300">
        Comparte tu experiencia, pregunta o mensaje en nuestro círculo sagrado
        de las 3AM.
      </p>
    </div>
  </div>
  <form class="space-y-6">
    <div class="space-y-4">
      <div>
        <label
          for="name"
          class="mb-2 block text-sm font-medium tracking-wider text-purple-300"
        >
          NOMBRE
        </label>
        <input
          required
          type="text"
          id="name"
          name="name"
          class="w-full rounded-[10px] border-2 border-purple-500/50 bg-black/40 px-4 py-3 text-white placeholder-purple-400/60 backdrop-blur-sm transition-colors duration-300 focus:border-cyan-400 focus:outline-none"
          placeholder="Tu nombre completo..."
        />
      </div>

      <div>
        <label
          for="email"
          class="mb-2 block text-sm font-medium tracking-wider text-purple-300"
        >
          EMAIL
        </label>
        <input
          required
          type="email"
          id="email"
          name="email"
          class="w-full rounded-[10px] border-2 border-purple-500/50 bg-black/40 px-4 py-3 text-white placeholder-purple-400/60 backdrop-blur-sm transition-colors duration-300 focus:border-cyan-400 focus:outline-none"
          placeholder="tu@email.com"
        />
      </div>

      <div>
        <label
          for="message"
          class="mb-2 block text-sm font-medium tracking-wider text-purple-300"
        >
          MENSAJE
        </label>
        <textarea
          required
          id="message"
          name="message"
          rows={6}
          class="w-full resize-none rounded-[10px] border-2 border-purple-500/50 bg-black/40 px-4 py-3 text-white placeholder-purple-400/60 backdrop-blur-sm transition-colors duration-300 focus:border-cyan-400 focus:outline-none"
          placeholder="Comparte tu experiencia, pregunta o mensaje con nosotros..."
        ></textarea>
      </div>
    </div>

    <div class="flex items-center justify-center text-center">
      <button
        type="submit"
        class="cursor-pointer rounded-[10px] border-2 border-cyan-400/50 bg-gradient-to-r from-[#790063] to-purple-600 px-8 py-4 font-semibold tracking-wider text-white shadow-lg transition-all duration-300 hover:border-cyan-400 hover:from-purple-600 hover:to-[#790063] hover:shadow-cyan-400/20"
      >
        <div class="flex items-center space-x-3">
          <div class="h-3 w-3 animate-pulse rounded-full bg-cyan-400"></div>
          <span>ENVIAR MENSAJE</span>
          <div class="h-3 w-3 animate-pulse rounded-full bg-cyan-400 delay-500">
          </div>
        </div>
      </button>
    </div>
  </form>
  <div class="mt-8 border-t border-[#790063]/50 pt-6">
    <div class="text-center">
      <p class="mb-4 text-sm tracking-wider text-purple-300">
        O CONTÁCTANOS DIRECTAMENTE
      </p>
      <div class="space-y-1 md:space-x-3">
        <a
          href="mailto:contacto@3amclub.com"
          target="_blank"
          class="inline-block text-sm tracking-wide text-cyan-400 hover:underline"
        >
          contacto@3amclub.com
        </a>
        <a
          href="https://wa.me/15553AMCLUB"
          target="_blank"
          rel="noopener noreferrer"
          class="inline-block text-sm tracking-wide text-purple-400 hover:underline"
        >
          WhatsApp: +1 (555) 3AM-CLUB
        </a>
      </div>
    </div>
  </div>
</Layout>

<script>
  import { actions, isInputError } from "astro:actions";

  const form = document.querySelector("form");
  const btn = document.querySelector("button[type=submit]");

  form?.addEventListener("submit", async (event) => {
    event.preventDefault();
    btn!.setAttribute("disabled", "true");

    const formData = new FormData(form);
    const { data, error } = await actions.contactAction(formData);

    btn!.removeAttribute("disabled");

    if (isInputError(error)) {
      const message = Object.values(error.fields).flat().join(", ");
      showToast({ message, icon: "⚠️", textColor: "text-red-500" });
    } else {
      showToast({
        message: data?.message || "Enviado con éxito",
        icon: "✅",
        textColor: "text-green-500",
      });
      form.reset();
    }
  });

  function showToast({
    message,
    icon,
    textColor,
  }: {
    message: string;
    icon: string;
    textColor: string;
  }) {
    const toast = document.createElement("div");

    toast.innerHTML = `
      <div class="fixed top-4 right-4 lg:top-8 lg:right-8 flex items-center font-semibold gap-2 px-4 py-2 rounded-[10px] border-2 border-[#790063] bg-black/80 p-8 shadow-2xl transform transition-transform duration-500 ease-in-out opacity-0 -translate-y-4 z-20 ${textColor}">
        <span>${icon}</span>
        <span>${message}</span>
      </div>
    `;
    document.body.appendChild(toast);

    const toastEl = toast.firstElementChild;
    if (!toastEl) return;

    requestAnimationFrame(() => {
      toastEl.classList.remove("opacity-0", "-translate-y-4");
      toastEl.classList.add("opacity-100", "translate-y-0");
    });

    setTimeout(() => {
      toastEl.classList.remove("opacity-100", "translate-y-0");
      toastEl.classList.add("opacity-0", "-translate-y-4");
      setTimeout(() => toast.remove(), 300);
    }, 3000);
  }
</script>
