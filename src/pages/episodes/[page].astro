---
import type { GetStaticPaths } from "astro";
import Layout from "@layouts/Layout.astro";
import { getCollection } from "astro:content";
import EpisodesLayout from "@layouts/EpisodesLayout.astro";

const pageTitle = "Episodios";
const description =
  "Explora todos los episodios de The 3 A.M Club: conversaciones nocturnas sobre creatividad, filosofía y cultura que inspiran nuevas ideas cada madrugada. Encuentra tu próximo episodio y acompáñanos en cada viaje a las 3 A.M.";

export const getStaticPaths = (async ({ paginate }) => {
  let episodes = await getCollection("podcast");
  episodes = episodes.sort((a, b) => {
    return (
      new Date(b.data.created_at).getTime() -
      new Date(a.data.created_at).getTime()
    );
  });
  const uniqueCategories = [
    ...new Set(episodes.map((episode) => episode.data.category).flat()),
  ];

  return paginate(episodes, {
    props: { categories: uniqueCategories },
    pageSize: 5,
  });
}) satisfies GetStaticPaths;

const { page, categories } = Astro.props;
const { data, url, currentPage, lastPage } = page;
---

<Layout pageTitle={pageTitle} description={description} url={url.current}>
  <EpisodesLayout
    data={data}
    categories={categories}
    url={url}
    currentPage={currentPage}
    lastPage={lastPage}
  />
</Layout>
