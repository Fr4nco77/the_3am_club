---
import Layout from "@layouts/Layout.astro";
import { getCollection, render } from "astro:content";
import { Image } from "astro:assets";
import PlayPauseButton from "@components/player/PlayPauseButton";
import Badge from "@components/Badge.astro";

type GetPaths = Promise<{ params: { id: string }; props: { episode: any } }[]>;

export async function getStaticPaths(): GetPaths {
  const episodes = await getCollection("podcast");

  return episodes?.map((episode) => ({
    params: { id: episode.id },
    props: { episode },
  }));
}

const { episode } = Astro.props;
const { Content } = await render(episode);
const { title, created_at, image, audio, cover, category } = episode.data;

const podcast = {
  id: episode.id,
  title,
  image,
  audio,
};
---

<Layout pageTitle={title}>
  <div class="mb-4 flex items-center gap-6">
    <PlayPauseButton
      podcast={podcast}
      client:load
      className="h-16 text-purple-300 transition-all duration-500 ease-in-out hover:scale-110 hover:text-[#790063]"
    />
    <div class="flex-1 items-center gap-3 text-purple-300">
      <p class="text-xs font-light tracking-wider">
        {created_at}
      </p>
      <div class="mb-1 flex items-center gap-3">
        <h2 class="text-2xl font-bold tracking-wide text-white">
          {title}
        </h2>
        <Badge class="border-purple-500/50 bg-black/60">{category}</Badge>
      </div>
    </div>
  </div>
  <Image
    width={1}
    height={1}
    src={cover}
    alt={title}
    loading="eager"
    class="mb-4 aspect-video w-full rounded-xl border border-white"
  />
  <div class="prose prose-purple prose-invert prose-lg mb-16 max-w-none">
    <Content />
  </div>
  <div class="text-center">
    <div class="rounded-[10px] border border-cyan-400/30 bg-black/20 p-4">
      <p class="text-sm leading-relaxed tracking-wide text-cyan-300 italic">
        "En las profundidades de la noche, cuando el mundo duerme, tu alma
        despierta a infinitas posibilidades. Eres parte de algo m√°s grande,
        explorador de dimensiones."
      </p>
      <div class="mt-2 flex justify-center space-x-1">
        <div class="h-2 w-2 animate-pulse rounded-full bg-cyan-400/60"></div>
        <div
          class="h-2 w-2 animate-pulse rounded-full bg-purple-400/60 delay-200"
        >
        </div>
        <div
          class="h-2 w-2 animate-pulse rounded-full bg-pink-400/60 delay-400"
        >
        </div>
      </div>
    </div>
  </div>
</Layout>
