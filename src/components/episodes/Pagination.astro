---
import { ArrowLeft, ArrowRight } from "@assets/icons";
import ArrowPagination from "./ButtonPagination.astro";

interface Urls {
  current: string;
  next?: string;
  prev?: string;
  first?: string;
  last?: string;
}

interface Props {
  currentPage: number;
  lastPage: number;
  url: Urls;
  delta?: number;
}

const { currentPage, lastPage, url, delta = 1 } = Astro.props;

function getPages(current: number, last: number, delta: number) {
  const range: (number | string)[] = [];
  const rangeWithDots: (number | string)[] = [];
  let l: number | undefined;

  for (let i = 1; i <= last; i++) {
    if (
      i === 1 ||
      i === last ||
      (i >= current - delta && i <= current + delta)
    ) {
      range.push(i);
    }
  }

  for (let i of range) {
    if (l) {
      if (typeof i === "number" && i - l === 2) {
        rangeWithDots.push(l + 1);
      } else if (typeof i === "number" && i - l > 2) {
        rangeWithDots.push("...");
      }
    }
    rangeWithDots.push(i);
    if (typeof i === "number") l = i;
  }

  return rangeWithDots;
}

const pages = getPages(currentPage, lastPage, delta);
---

{
  lastPage > 1 && (
    <nav aria-label="Paginación" class="flex justify-center">
      <ul class="flex flex-wrap items-center justify-end gap-1 text-sm sm:gap-2 sm:text-base">
        <ArrowPagination url={url.prev} label="Anterior Pagina" size="h-8">
          <ArrowLeft />
        </ArrowPagination>

        {pages.map((page) => (
          <li
            class:list={[
              "h-8 w-8",
              page !== currentPage &&
                page !== "..." &&
                "hidden text-center sm:flex",
            ]}
          >
            {page === "..." ? (
              <span class="flex size-full items-end justify-center text-gray-400">
                …
              </span>
            ) : page === currentPage ? (
              <span
                aria-current="page"
                class="flex size-full items-center justify-center rounded-md border border-cyan-400 bg-cyan-400/20 p-1 text-cyan-400"
              >
                {page}
              </span>
            ) : (
              <a
                href={`/episodes/${page}`}
                class="size-full rounded-md border border-purple-500/50 bg-transparent p-1 text-purple-400 hover:bg-purple-500/20 hover:text-white"
              >
                {page}
              </a>
            )}
          </li>
        ))}

        <ArrowPagination url={url.next} label="Siguiente Pagina" size="h-8">
          <ArrowRight />
        </ArrowPagination>
      </ul>
    </nav>
  )
}
